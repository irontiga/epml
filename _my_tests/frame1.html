<!DOPCTYPE html>
<html>
    <head>

    </head>
    <body>
        <h1>Frame 1 :D</h1>

        <script type="module">
        import Epml from '../src/Epml.js'
        import contentWindowPlugin from '../src/plugins/contentWindows/contentWindows.js'
            import workerPlugin from '../src/plugins/workers/workers.js'
        Epml.registerPlugin(contentWindowPlugin)
        Epml.registerPlugin(workerPlugin)
        const startTime = Date.now()
        
        document.addEventListener("DOMContentLoaded", event => {
            const parentEpml = new Epml({ type: 'WINDOW', source: window.parent })

            parentEpml.ready().then(() => {
                console.log('Parent ready')
                parentEpml.route('hi', async req => {
                    return (Date.now() - startTime) / 1000
                })
            })

            parentEpml.imReady()
        })

        /**
         * === WEBWORKER ===
         */

        const worker = new Worker('workerTest_build.js')
        const workerEpml = new Epml({type: 'WORKER', source: worker})

        console.log('INDEX: ', workerEpml)

        workerEpml.ready().then(() => {
            console.log('Worker is ready :)')

            workerEpml.request('RandNum').then(res => {
                console.log(`Got random number ${res}`)
            })
        })

        workerEpml.imReady()
            
        </script>
    </body>
</html>